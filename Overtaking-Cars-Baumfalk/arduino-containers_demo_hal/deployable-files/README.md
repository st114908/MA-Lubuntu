# Deployable Code

The deployable code rearranges the generated code and rewquires the following adaptions:

## mosquitto

The generated Docker configuration for starting up a mosquitto MQTT Sever, see ```README.txt```.
Copied from the generated code without adjustments.

## README.txt

The README file generated by the Arduino Container Code generator.
Copied from the generated code without adjustments.

## ECU Directories

The ECU directories are copied from the generated code including all contained file.

### Preparing the Generated Component Code
The files of the component code generation in the ```fastAndSlowCar_v2``` directory of the generated code will be moved into different ECU directories.
Before that, some adjustments have to be made to the file content:
* The include statements need to be adjusted for all copied files. Because the files won't be arranged in further subdirectories for the deployment, remove all preceding paths in include statement so that only the name of the included file remains.
* For all header files in the ```components```subdirectory: The ```clock.h``` file must pulled up to be outside of the ```extern "C" {...}``` part!

### Adding the Generated Component Code

After that, the prepared files from the ```fastAndSlowCar_v2``` directory of the generated code are added to specific ECU directories of the deployable code.

In the following, this is explained for each subdirectory of the ```fastAndSlowCar_v2``` directory:
* components
    * The ```coordinatorComponent``` files are added to both ```CoordinatorECU``` directories
    * The remaining files are added to the ```DriverECU``` directories
* lib
    * the files ```clock.h``` and ```standardTypes.h``` are not used
    * the other files are copied to all ECU directories
* messages
    * ```messages_types.h``` is copied to all ECU directories
* operations
    * the files are copied only to the ```DriverECU``` directories
* RTSCs
    * ```coordinatorCoordinatorComponentStateChart.c``` is copied to the ```CoordinatorECU``` directories
    * ```driveControlDriveControlComponentStateChart.c``` is copied to the ```DriverECU``` directories
* types
    * the files are copied to all ECU directories
* The files ```CMakeLists.txt``` and ```Doxyfile```are not used

### Adding and Integrating the HAL
TODO

* In the ```robotCarPowerTrainOpRep.h```, which contains the operation repository method stub definitions, the ```lineFollower.h``` robot car lib is inlcuded, and in the ```robotCarPowerTrainOpRep.c``` it is used to implement the method stubs.

The other directories contain the code generated by the Arduino Container Code generator. The container code provides the environment for the component code to be executed. To enable the build using the Arduino tools, the following files were copied into each of the four ECU directories:
* The ```APImappings``` code.  The coordinator ECUs need no APImappings, and the fastCarDriver needs the ```...F...``` APImappings
* The ```components4Arduino``` code. When copied into the respective ECU directories, the values for the ```desiredVelocity``` and ```slowVelocity``` can be set individually in the ```driveControlDriveControlComponentStateChart.c``` of the ```...DriverECU``` directories.
* The ```robotCarLibs``` as they are included by the above code.
* In the main files of the Driver ECUs: The initialization functions of the robotCarLibs have to be added manually, i.e., 
    ```
    initializeDistanceSensors();
    initLineFollower();
    ```
    The reason is, that the initilization of devices is currently not supported by the the code generation.
